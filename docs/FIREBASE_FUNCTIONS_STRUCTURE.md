# Firebase Cloud Functions Development Guide

This document provides information about the Firebase Cloud Functions setup for PromptFinder.

## Project Structure

The Cloud Functions code is organized in the `/functions` directory with the following structure:

- `/functions/src` - TypeScript source code
- `/functions/lib` - Compiled JavaScript (generated by TypeScript compiler)
- `/functions/package.json` - Functions-specific dependencies and scripts
- `/functions/tsconfig.json` - TypeScript configuration
- `/functions/.eslintrc.js` - ESLint configuration for the Functions code

## Development Setup

Firebase Cloud Functions has its own separate Node.js environment with its own dependencies. This is by Firebase design, as Cloud Functions runs in a separate environment from the client code.

### Installing Dependencies

```bash
cd functions
npm install
```

### Building the Functions

```bash
npm run build
```

This compiles the TypeScript code in `/src` to JavaScript in `/lib`.

### Running the Functions Locally

```bash
npm run serve
```

This starts the Firebase Emulator Suite with the Functions emulator.

## Linting and Formatting

The Firebase Functions code uses ESLint and Prettier for linting and formatting:

```bash
# Run linting
npm run lint

# Fix linting issues automatically
npm run lint:fix
```

## Implemented Functions

The following Cloud Functions are implemented:

1. **recalculateRating** - Triggered when a user adds, updates, or removes a rating for a prompt. It recalculates the average rating and total ratings count for the prompt.

2. **updateFavoritesCount** - Triggered when a user favorites or unfavorites a prompt. It maintains an accurate count of favorites.

3. **incrementUsageCount** - Called when a user copies a prompt, incrementing the usage count.

4. **recalculateAllStats** - An admin-only function that recalculates all statistics for all prompts in the database.

## Deployment

To deploy the functions to Firebase:

```bash
npm run deploy
```

For more detailed deployment information, see [FIREBASE_CLOUD_FUNCTIONS_DEPLOYMENT.md](/docs/FIREBASE_CLOUD_FUNCTIONS_DEPLOYMENT.md).

## Testing

For testing procedures, see [TESTING_CLOUD_FUNCTIONS.md](/docs/TESTING_CLOUD_FUNCTIONS.md) and [CLOUD_FUNCTIONS_TEST_PLAN.md](/docs/CLOUD_FUNCTIONS_TEST_PLAN.md).
